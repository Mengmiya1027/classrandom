# 课堂随机点名说明文档

# AI提示词：

# 前情提要：用户的项目为一个使用javascript的vue3项目。

## 项目主旨与逻辑
此项目为了实现课堂随机点名、记分功能。

本处主要讲解逻辑方面。有关设计的部分，将在下一部分内容中详细说明。

包含有小组、学生、分数、概率信息。通过小组区分学生，每个学生有一个分数和一个概率。

设想的模版结构如下：
app.vue（根文件）在启动时显示components/mainpage.vue。mainpage.vue中会呼出editpage.vue和statistics.vue。但是这两个组件需要覆盖在mainpage.vue之上，也就是他们会需要在app.vue中进行引入。
此外，这三个文件会需要进行数据交换，而我并不想使用复杂的事件总线。所以你需要为我提供一种简单的通信方式。注意尽量不使用localStorage（用户指定除外）。

传入的基础数据来自assets/data/students.json，仅包含班级、小组、学生名字，为一个json，类似：

```json
[
  {
    "class-name": "8班",
    "groups": [
      {
        "group-id": 1,
        "students": ["张三", "李四"]
      },
      {
        "group-id": 2,
        "students": ["王五", "赵六"]
      }
    ]
  },
  {
    "class-name": "9班",
    "groups": [
      {
        "group-id": 1,
        "students": ["小明", "小红"]
      },
      {
        "group-id": 2,
        "students": ["豆豆", "大张"]
      }
    ]
  }
]
```

注意所有数据均为实时更新。需要进行传输的数据不包含班级信息，而是包含后文提及“选择的班级”的小组、学生信息，并添加"score"、"probability"、"duration"，为一个json。
为小组添加了属性"other"，表示小组的其他加分。此json类似：

```json
[
  {
    "group-id": 1,
    "other": 3,
    "students": [
      {
        "name": "张三",
        "score": 1,
        "probability": 0.5,
        "duration": 1
      },
      {
        "name": "李四",
        "score": 0,
        "probability": 1,
        "duration": 0
      }
    ]
  },
  {
    "group-id": 2,
    "other": 0,
    "students": [
      {
        "name": "王五",
        "score": 5,
        "probability": 0.1,
        "duration": 15
      },
      {
        "name": "赵六",
        "score": -1,
        "probability": 1.2,
        "duration": 0
      }
    ]
  }
]
```

可以观察到上文为选择8班时的信息。

mainpage.vue中会需要处理到以下问题：
1. 选择和显示不同班级的小组、学生信息
2. 随机点名功能
3. 记分功能

其中主要功能为：
1. 正常情况下，点击随机点名按钮后，会从所有学生中随机选择一名学生。
2. 将这个学生记录至抽取历史中（组别+时间）。
3. 可以为当前抽中的学生添加、减少分数。该功能涉及到上文"score"。

为确保公平，推出普通模式和可选的公平模式。分为小组公平和个人公平。该功能涉及到上文"probability"、"duration"（抽取概率、当前概率持续时间）。
1. 普通模式：不考虑学生的概率，直接随机抽取。
2. 小组公平模式：
   考虑概率抽取。
   初始化：一轮抽取结束后，将所有“'duration'大于0的学生”的"duration"减1，操作完成后再将所有“'duration'等于0的学生”的"probability"设置为1。
   公平机制1：如果最近10次（包括本次）抽取中，某个小组内学生的被抽取次数大于4次（按"group-id"统计，而非"name"），那么该小组内的所有学生的概率降低0.3，该小组所有学生的"duration"设置为10。
   公平机制2：如果最近10次（包括本次）抽取中，某个小组内学生的被抽取次数小于2次（按"group-id"统计，而非"name"），那么该小组内的所有学生的概率增加1，该小组所有学生的"duration"设置为10。
3. 个人公平模式：
   考虑概率抽取。
   初始化：一轮抽取结束后，将所有“'duration'大于0的学生”的"duration"减1，操作完成后再将所有“'duration'等于0的学生”的"probability"设置为1。
   公平机制1：如果最近10次（包括本次）抽取中，某个学生的被抽取次数大于4次（按"name"统计，而非"group-id"），那么该学生的概率降低0.3，该学生的"duration"设置为10。
   公平机制2：如果最近10次（包括本次）抽取中，某个学生的被抽取次数小于2次（按"name"统计，而非"group-id"），那么该学生的概率增加1，该学生的"duration"设置为10。

editpage.vue中会需要处理到以下问题：
1. 显示mainpage.vue中选择的小组、学生，并且显示其分数、概率、持续时间。"other"作为一个单独的项目，加在每组学生的下方，仅显示其分数。
2. 编辑所有人的信息（包括姓名、班级、分数、概率、持续时间）。支持批量编辑。实时更新。"other"仅能编辑分数。
3. 编辑工具设置。
   需要注意的是，为了简化代码，第2点涉及处可以使用横排的表格+组别分割线。

statistics.vue中会需要处理到以下问题：
1. 结算。
   结算按多方面。
   首先是按照"group-id"由高到低统计每个小组的总分数。排名前3的小组被单独列出。注意计算小组总分时要将"other"的分数也加入。
   然后是按照"name"由高到低统计每个学生的总分数
   最后按照抽取历史由高到低统计每个学生的被抽取次数。次数前3的学生被单独列出。

注意：
1. 所有数据均为实时更新。
2. 抽取环节的匹配、统计环节的排名均需要考虑并列情况。

## 界面设计

使用[x]表示某个项目的分数。使用深色指代较深的主题色。能使用fontawesome的尽量使用它们。

首先是mainpage.vue的界面设计。

左上角对齐为标题"课堂随机点名Pro"

接下来一个卡片，左对齐，宽度为30%，高度为窗口高度-标题高度。这个卡片就是为了显示抽取历史。

右侧为一个卡片，右对齐，宽度为30%，高度占满。这个卡片需要详细讲讲：
1. 在未选择班级时候，在中心显示"请先选择班级"，下面显示按钮，按钮的数量取决于传入班级的个数。每个按钮的文字为班级名称。
2. 在选择班级后，显示小组数量个div。这些div左侧为圆角方形，内显示小组id，下方显示当前小组总分（[x]）。右侧为学生列表。每个学生占一行，改行左侧为稍浅一些的圆角矩形，内显示学生名称。右侧为学生分数。注意学生列表的底部要预留一行，用于显示"other"的分数。这行仅有灰色的字体显示“其他加分：[x]”
   并且在该卡片最下方（非小组列表的底部），并排显示两个按钮，分别为深色的“统计”和浅灰色的“编辑”。这两个按钮分别点击后，会呼出statistics.vue和editpage.vue。

中部为一个透明div，这个div上部分为一个圆角矩形，内显示抽取结果（仅名称）。下部分又为一个水平居中的透明div。
这个div上部为圆角矩形操作栏，包含并排的按钮“当前学生+1”、“当前学生-1”、“当前学生+3”、“上一学生+3”。下部为一个圆角矩形，左侧为“开始抽取”按钮，右侧为下拉菜单，可以选择普通模式、小组公平模式、个人公平模式。

中部的底部显示灰色的"Created with Vite Vue, made by Mengmiya1027"，以及Vite与Vue的图标。

随后是editpage.vue的界面设计。

左上角为标题"编辑抽取与统计信息"，右上角为“批量编辑”按钮和关闭按钮。

下方为信息列表，由多个div组成。每个div左侧为圆角方形，内上下左右居中显示大数字，为组别id。右侧div每行为一个学生的信息，包括姓名、班级、分数、概率、持续时间。
可以修改的有分数（+按钮|输入框（也用于显示）|-按钮）、概率（输入框（也用于显示））、持续时间（输入框（也用于显示））。
右侧div最下方显示"other"的分数（+按钮|输入框（也用于显示）|-按钮）。

点击批量编辑按钮后，会弹出一个弹窗。弹窗内仍然为类似的信息列表，但是每个学生项（包括other）仅显示信息，没有编辑的控件，而且最右侧为一个复选框。组别id的下侧也有一个复选框，用于选择/取消选择该组别下的所有学生。左上角为一个复选框，用于选择/取消选择所有学生。右上角为按钮取消/设置。
点击右上角的设置后，关闭原有弹窗，弹出一个新弹窗。弹窗内显示设置：分数、概率、持续时间。每个设置项下方为一个输入框，用于输入新的设置值。
弹窗内还包含两个按钮“取消”“确认”，点击确认后会将新的设置值应用到所有选中的学生（包括other）。

最后是statistics.vue的界面设计。

这个就比较简单了，按照逻辑部分简单设计下即可。

设计需要精美，动画简洁不杂乱即可。